const PLAYER_ANIM_GRAPH_ASSET_ID=141184284;var PlayerLoader=pc.createScript("playerLoader");PlayerLoader.attributes.add("glbUrl",{type:"string"}),PlayerLoader.attributes.add("parry_active_override",{type:"number"}),PlayerLoader.attributes.add("parry_inactive_override",{type:"number"}),PlayerLoader.attributes.add("riposte_hit_override",{type:"number"});var playerMaterial=new pc.StandardMaterial;playerMaterial.blendType=pc.BLEND_NORMAL;let emissiveValue=1;PlayerLoader.prototype.initialize=function(){var e=this,{app:a,entity:r}=e;a.on("gameInitializer:retrievedDayId",(function(t){r.addComponent("anim",{});var i,n={},o={global:{postprocess:function(a){if(a){var r=a.animations;if(r)for(var t=0;t<r.length;++t){var i=r[t].extras??{};if("Parry"===r[t].name&&(e.parry_active_override&&(i={...i,parry_active:e.parry_active_override}),e.parry_inactive_override&&(i={...i,parry_inactive:e.parry_inactive_override})),"Riposte"===r[t].name&&e.riposte_hit_override&&(i={...i,riposte_hit:e.riposte_hit_override}),n[r[t].name]=[],i){const e=Object.keys(i).map((e=>({name:e,time:i[e]/24})));n[r[t].name]=e}}}a.extras}}},s=0,c=0;const p=`${globalCdnUrl}/${t}/Character.glb`;utils.loadGlbContainerFromUrl(p,o,"Character.glb",(function(t,o){if(t)console.error(t);else{var p=pc.app.assets.get(141184284).resource;e.entity.anim.loadStateGraph(p);for(var l=0;l<o.resource.animations.length;++l){var y=o.resource.animations[l],d=loadingUtils.setupBaseAnimationEvents(y.resource.name,y.resource.duration),m=n[y.resource.name],u=new pc.AnimEvents([...d,...m]);u&&(y.resource.events=u);var v=p.layers[0].states.find((e=>e.name===y.resource.name))?.loop;e.entity.anim.assignAnimation(y.resource.name,y.resource,"Base",1,v),"Parry"===y.resource.name&&(s=m.find((e=>"parry_active"===e.name))?.time??e.parry_active_override/24,c=m.find((e=>"parry_inactive"===e.name))?.time??e.parry_inactive_override/24)}r.anim.on("Riposte-end",(function(e){})),r.anim.on("riposte_hit",(function(e){a.fire("playerLoader:Riposte-end")})),r.anim.on("DefeatTransition-begin",(function(e){a.fire("playerLoader:DefeatTransition-begin")})),r.anim.on("Parry-start",(function(e){r.anim.setBoolean("IsParryWindowOpen",!0)})),r.anim.on("Parry-begin",(function(e){i=new Date})),r.anim.on("parry_active",(function(e){emissiveValue=1,r.anim.setBoolean("IsParryWindowOpen",!0)})),r.anim.on("parry_inactive",(function(e){r.anim.setBoolean("IsParryWindowOpen",!1),a.fire("playerLoader:parryWindowEnd")}));var h=o.resource.instantiateRenderEntity(),f=h.children[0].c.render.meshInstances[0].material.clone();h.children[0].c.render.meshInstances[0].material=f,playerMaterial=f,e.entity.addChild(h),a.on("enemyLoader:hit",(function(){if(a.fire("camera:shake"),r.anim.getBoolean("IsParryWindowOpen"))r.anim.setTrigger("TriggerParrySuccess"),a.fire("playerLoader:parriedHit");else{if(a.fire("playerLoader:hit"),"Parry"===r.anim.baseLayer.activeState)r.anim.baseLayer.activeStateCurrentTime<s?a.fire("playerLoader:lateParry",s-r.anim.baseLayer.activeStateCurrentTime):a.fire("playerLoader:earlyParry",r.anim.baseLayer.activeStateCurrentTime-c);else if("parry"===r.anim.layers.activeState&&i){const e=parseFloat((new Date-i)/1e3);a.fire("playerLoader:earlyParry",e),i=void 0}r.anim.setTrigger("TriggerHitByEnemy",!0)}})),a.on("gameStateManager:defeat",(function(){r.anim.setBoolean("IsDefeated",!0)})),a.fire("playerLoader:finishedLoading"),a.touch&&(isTouch=!0,a.touch.on(pc.EVENT_TOUCHSTART,e.onTouchStart,e),a.touch.on(pc.EVENT_TOUCHEND,e.onTouchCancel,e),a.touch.on(pc.EVENT_TOUCHCANCEL,e.onTouchCancel,e))}})),r.setPosition(0,0,-.8),e.gameStarted=!1,a.on("gameStateManager:startGame",(function(){e.gameStarted=!0}))}))},PlayerLoader.prototype.update=function(e){this.gameStarted&&(this.app.keyboard.wasPressed(pc.KEY_SPACE)&&this.entity.anim.setBoolean("IsInputParry",!0),this.app.keyboard.wasReleased(pc.KEY_SPACE)&&this.entity.anim.setBoolean("IsInputParry",!1),this.app.mouse.wasPressed(pc.MOUSEBUTTON_LEFT)&&this.entity.anim.setBoolean("IsInputParry",!0),this.app.mouse.wasReleased(pc.MOUSEBUTTON_LEFT)&&this.entity.anim.setBoolean("IsInputParry",!1)),emissiveValue>.1&&(emissiveValue-=e),playerMaterial.emissive.set(emissiveValue,emissiveValue,emissiveValue),playerMaterial.update()};var hasTouchedOnce=!1;PlayerLoader.prototype.onTouchStart=function(e){hasTouchedOnce?this.gameStarted&&hasTouchedOnce&&e.touches.length>0&&this.entity.anim.setBoolean("IsInputParry",!0):hasTouchedOnce=!0},PlayerLoader.prototype.onTouchCancel=function(e){this.gameStarted&&0===e.touches.length&&this.entity.anim.setBoolean("IsInputParry",!1)};!function(){var n={},e=pc.Application.getApplication();n.loadGlbContainerFromAsset=function(n,t,o,i){var a=function(n){var e=new Blob([n.resource]),a=URL.createObjectURL(e);return this.loadGlbContainerFromUrl(a,t,o,(function(n,e){i(n,e),URL.revokeObjectURL(a)}))}.bind(this);n.ready(a),e.assets.load(n)},n.loadGlbContainerFromUrl=function(n,t,o,i){var a=o,r={url:n,filename:a},l=new pc.Asset(a,"container",r,null,t);return l.once("load",(function(n){if(i){var e=n.resource.animations;if(1==e.length)e[0].name=o;else if(e.length>1)for(var t=0;t<e.length;++t)e[t].name=o+" "+t.toString();i(null,n)}})),e.assets.add(l),e.assets.load(l),l},window.utils=window.utils?{...window.utils,...n}:n}();var CameraLoader=pc.createScript("cameraLoader");CameraLoader.attributes.add("glbUrl",{type:"string"}),CameraLoader.prototype.initialize=function(){const{app:a,entity:e}=this;var r=utils.getFileName(this.glbUrl);utils.loadGlbContainerFromUrl(this.glbUrl,{},r,(function(r,t){if(r)console.error(r);else{e.addComponent("anim",{});for(var i=0;i<t.resource.animations.length;++i){var n=t.resource.animations[i];e.anim.assignAnimation(n.resource.name,n.resource,"Base",1,!1)}var o=t.resource.instantiateRenderEntity();e.addChild(o);var s=e.findByName("CameraBone"),m=t.resource.data.gltf.cameras[0].perspective;s.addComponent("camera",{aspectRatio:m.aspectRatio,nearClip:m.znear,farClip:m.zfar,fov:100*m.yfov}),e.addComponent("script"),e.script.create("cameraShake",{attributes:{shakeInterval:.05,maxShakeDistance:.1,duration:.5}}),e.anim.baseLayer.transition("ArmatureCameraStart",0),a.on("playerLoader:parriedHit",(function(){}))}}))},CameraLoader.prototype.update=function(a){const{app:e,entity:r}=this;e.keyboard.wasPressed(pc.KEY_9)&&r.anim.baseLayer.transition("ArmatureCameraStart",.2),e.keyboard.wasPressed(pc.KEY_8)&&r.anim.baseLayer.transition("ArmatureCameraRiposte",.2)};const ENEMY_ANIM_GRAPH_ASSET_ID=141506304,HIT_PARTICLE_SYSTEM_ASSET_ID=172172554;var EnemyLoader=pc.createScript("enemyLoader");EnemyLoader.attributes.add("glbUrl",{type:"string"}),EnemyLoader.prototype.initialize=async function(){const{app:e,entity:n}=this,{root:t}=e;e.on("gameInitializer:retrievedDayId",(function(a){var r={},i=e.assets.get(172172554),o={global:{postprocess:function(e){if(e){var n=e.animations;if(n)for(var t=0;t<n.length;++t){var a=n[t].extras;if(r[n[t].name]=[],a){const e=Object.keys(a).map((e=>({name:e,time:a[e]/24})));r[n[t].name]=e}}}e.extras}}},s=new pc.Vec3;const c=`${globalCdnUrl}/${a}/Enemy.glb`;utils.loadGlbContainerFromUrl(c,o,"Enemy.glb",(function(a,o){if(n.addComponent("anim",{}),a)console.error(a);else{var c=pc.app.assets.get(141506304).resource;n.anim.loadStateGraph(c);for(var d=0;d<o.resource.animations.length;++d){var l=o.resource.animations[d],m=loadingUtils.setupBaseAnimationEvents(l.resource.name,l.resource.duration),u=r[l.resource.name],p=new pc.AnimEvents([...m,...u]);p&&(l.resource.events=p),n.anim.assignAnimation(l.resource.name,l.resource)}e.on("playerLoader:Riposte-end",(function(){n.enabled=!1})),e.on("attackScheduler:scheduleAttack",(function(){n.anim.setTrigger("TriggerAttack",!0)})),e.on("playerLoader:parriedHit",(function(){var e=i.resource.instantiate(),a=new pc.Vec3;a.add2(n.localPosition,s),e.setPosition(a),t.addChild(e),n.anim.setTrigger("TriggerRecoil")})),e.on("Attack-end",(()=>{})),n.anim.on("Attack-end",(()=>{}),this),n.anim.on("hit_start",(function(n){e.fire("enemyLoader:hit")}),this);var g=o.resource.instantiateRenderEntity();s=o.resource.renders[0].resource.meshes[0].aabb.center,n.addChild(g),e.fire("enemyLoader:finishedLoading")}})),n.setPosition(0,0,.8),n.setLocalRotation((new pc.Quat).setFromEulerAngles(0,180,0))}))};const AttackScheduler=pc.createScript("attackScheduler");AttackScheduler.IsAttackSchedulerOn=!1,AttackScheduler.AttackTimer=0,AttackScheduler.prototype.initialize=function(){this.app.on("gameStateManager:startGame",(()=>{AttackScheduler.IsAttackSchedulerOn=!0})),this.app.on("gameStateManager:defeat",(()=>{AttackScheduler.IsAttackSchedulerOn=!1}))},AttackScheduler.prototype.update=function(t){AttackScheduler.IsAttackSchedulerOn&&(AttackScheduler.AttackTimer+=t,AttackScheduler.AttackTimer>=3&&(this.app.fire("attackScheduler:scheduleAttack"),AttackScheduler.AttackTimer=0))};var StartButton=pc.createScript("startButton");StartButton.prototype.initialize=function(){const{app:t,entity:i}=this;i.button.on("click",(()=>{t.fire("startButton:clicked")}))};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},onUpdate:function(t){return this.on("update",t),this},onComplete:function(t){return this.on("complete",t),this},onLoop:function(t){return this.on("loop",t),this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var FadeOutOnstart=pc.createScript("fadeOutOnstart");FadeOutOnstart.prototype.initialize=function(){const t=this,{app:e,entity:a}=t;t.buttonClicked=!1,e.on("gameStateManager:startGame",(function(){if(!t.buttonClicked){t.buttonClicked=!0;var e={value:1};this.tween(e).to({value:0},1,pc.Linear).onUpdate((function(){a.element.opacity=e.value})).start()}}))};var GameStateManager=pc.createScript("gameStateManager");const isFunctionKey=e=>e&&e.key>=112&&e.key<124,isShiftKey=e=>e&&16===e.key,DailyResultKey="dailyResult",resultWriter=(e,a)=>{if("success"===e.type)return"ðŸŸ© Success ðŸŸ©";var t=a>=5?"ðŸŸ¥":"ðŸŸ¨";return"early"===e.type?`${e.time} MILLISECONDS EARLY ${t}`:"late"===e.type?`${t} ${e.time} MILLISECONDS LATE`:void 0};function copyToClipboard(e){var a=document.createElement("textarea");a.value=e,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}const WriteParryAttemptsToStorage=e=>{localStorage.setItem("dailyResult",JSON.stringify(e))};GameStateManager.checkLoaded=()=>{GameStateManager.isPlayerLoaded&&GameStateManager.isEnemyLoaded&&pc.app.fire("gameStateManager:loaded")},GameStateManager.fireStartGame=e=>{!GameStateManager.isPlayerLoaded||!GameStateManager.isEnemyLoaded||GameStateManager.isGameStarted||isFunctionKey(e)||isShiftKey(e)||(GameStateManager.isGameStarted=!0,pc.app.fire("gameStateManager:startGame"))},GameStateManager.prototype.initialize=function(){const{app:e}=this;GameStateManager.parryAttemptResults=[],GameStateManager.isPlayerLoaded=!1,GameStateManager.isEnemyLoaded=!1,GameStateManager.isGameStarted=!1;var a=localStorage.getItem("dailyResult");if(a)try{GameStateManager.parryAttemptResults=JSON.parse(a)}catch{}e.on("startButton:clicked",GameStateManager.fireStartGame),e.keyboard.on(pc.EVENT_KEYUP,GameStateManager.fireStartGame),e.on("playerLoader:parriedHit",(function(){GameStateManager.parryAttemptResults.push({type:"success",time:0}),localStorage.setItem("dailyResult",JSON.stringify([])),e.fire("gameStateManager:resultsUpdated","success")})),e.on("playerLoader:lateParry",(function(a){GameStateManager.parryAttemptResults.push({type:GameStateManager.parryAttemptResults.length>=6?"defeat":"late",time:1e3*a}),localStorage.setItem("dailyResult",JSON.stringify(GameStateManager.parryAttemptResults)),GameStateManager.parryAttemptResults.length>=6?(e.fire("gameStateManager:defeat"),localStorage.setItem("dailyResult",JSON.stringify([])),e.fire("gameStateManager:resultsUpdated","failure")):e.fire("gameStateManager:resultsUpdated","late")})),e.on("playerLoader:earlyParry",(function(a){GameStateManager.parryAttemptResults.push({type:GameStateManager.parryAttemptResults.length>=6?"defeat":"early",time:1e3*a}),localStorage.setItem("dailyResult",JSON.stringify(GameStateManager.parryAttemptResults)),GameStateManager.parryAttemptResults.length>=6?(e.fire("gameStateManager:defeat"),localStorage.setItem("dailyResult",JSON.stringify([])),e.fire("gameStateManager:resultsUpdated","failure")):e.fire("gameStateManager:resultsUpdated","early")})),e.on("playerLoader:finishedLoading",(function(){GameStateManager.isPlayerLoaded=!0,GameStateManager.checkLoaded()})),e.on("enemyLoader:finishedLoading",(function(){GameStateManager.isEnemyLoaded=!0,GameStateManager.checkLoaded()})),e.on("shareButton:clicked",(function(){copyToClipboard(GameStateManager.parryAttemptResults.map(((e,a)=>resultWriter(e,a))).join("\r\n")),e.fire("shareButton:copiedToClipboard")}))};var CameraShake=pc.createScript("cameraShake");CameraShake.attributes.add("shakeInterval",{type:"number",default:.1,title:"Camera Shake Interval"}),CameraShake.attributes.add("maxShakeDistance",{type:"number",default:.1,title:"Max Shake Distance"}),CameraShake.attributes.add("duration",{type:"number",default:1,title:"Duration"}),CameraShake.prototype.initialize=function(){CameraShake.initializeStartingValues(this),CameraShake.initializeEventSubscriptions(this)},CameraShake.prototype.update=function(a){CameraShake.updateCameraPosition(a,this)},CameraShake.initializeStartingValues=a=>{const{entity:e}=a;a.time=Number.MAX_SAFE_INTEGER,a.timeSinceLastShake=Number.MAX_SAFE_INTEGER,a.startPosition=e.getPosition().clone()},CameraShake.initializeEventSubscriptions=a=>{const{app:e,entity:t}=a;e.on("camera:shake",(()=>{a.time=0,a.timeSinceLastShake=0,t.setLocalPosition(a.startPosition)}))},CameraShake.updateCameraPosition=(a,e)=>{const{duration:t,entity:i,maxShakeDistance:n,shakeInterval:r,startPosition:m,time:s,timeSinceLastShake:o}=e,h=o>=r;s<t&&(CameraShake.incrementCameraShakeTimers(a,e),h?(CameraShake.moveCameraRandomly(t,i,n,m,s),e.timeSinceLastShake-=r):i.setLocalPosition(m))},CameraShake.incrementCameraShakeTimers=(a,e)=>{e.time+=a,e.timeSinceLastShake+=a},CameraShake.moveCameraRandomly=(a,e,t,i,n)=>{const r=1-this.pc.math.clamp(n/a,0,1),m=2*Math.PI*this.pc.math.random(0,1),s=this.pc.math.random(0,t)*r+this.pc.math.random(0,t)*r,o=s>1?2-s:s,h=o*Math.cos(m),S=o*Math.sin(m);e.setLocalPosition(i.x+h,i.y+S,i.z)};!function(){var n={setupBaseAnimationEvents:(n,e)=>[{name:`${n}-begin`,time:0},{name:`${n}-end`,time:e}]};window.loadingUtils=n}();var FadeInonFinish=pc.createScript("fadeInonFinish");FadeInonFinish.attributes.add("opacityTarget",{type:"number",default:0,title:"Opacity Target"}),FadeInonFinish.prototype.initialize=function(){var{app:e,entity:t}=this,a=this.opacityTarget;e.on("playerLoader:Riposte-end",(function(){var e={value:0};this.tween(e).to({value:a},1,pc.Linear).onUpdate((function(){t.element.opacity=e.value})).start()})),e.on("playerLoader:DefeatTransition-begin",(function(){var e={value:0};this.tween(e).to({value:a},1,pc.Linear).onUpdate((function(){t.element.opacity=e.value})).start()}))};var ShareButton=pc.createScript("shareButton");ShareButton.prototype.initialize=function(){const t=this,{app:e,entity:n}=t;t.isSharable=!1,e.on("playerLoader:Riposte-end",(function(){t.isSharable=!0})),e.on("playerLoader:DefeatTransition-begin",(function(){t.isSharable=!0})),n.button.on("click",(function(){t.isSharable&&e.fire("shareButton:clicked")}))};var ClipboardToast=pc.createScript("clipboardToast");ClipboardToast.prototype.initialize=function(){const{app:t,entity:o}=this;t.on("shareButton:copiedToClipboard",(function(){var t={value:1};this.tween(t).to({value:0},1,pc.CubicIn).onUpdate((function(){o.element.opacity=t.value})).start()}))};const AudioManager=pc.createScript("audioManager"),LAST_VOLUME_KEY="lastVolume";AudioManager.DefaultVolume=.2,AudioManager.prototype.initialize=function(){AudioManager.initalizeVolumeUpdater(this),AudioManager.initalizeEventSubscriptions(this),AudioManager.initalizeVolume(this)},AudioManager.initalizeVolumeUpdater=()=>{AudioManager.debouncedUpdateLocalStorageVolume=debounce((e=>localStorage.setItem("lastVolume",e)),1e3)},AudioManager.initalizeEventSubscriptions=e=>{const{app:a,entity:o}=e,{sound:t}=o;a.on("playerLoader:hit",(()=>{t.play("playerHitSound")})),a.on("playerLoader:parriedHit",(()=>{t.play("parrySound")})),a.on("playerLoader:Riposte-end",(()=>{t.play("enemyHitSound")})),a.on("gameStateManager:startGame",(()=>{t.play("doubletaikodrop")})),a.on("volumeBar:onChange",(e=>{t.volume=e,AudioManager.debouncedUpdateLocalStorageVolume(e)}))},AudioManager.initalizeVolume=e=>{const{entity:a}=e,{sound:o}=a;var t=localStorage.getItem("lastVolume");t?o.volume=t:(o.volume=AudioManager.DefaultVolume,localStorage.setItem("lastVolume",AudioManager.DefaultVolume))};var HitstopManager=pc.createScript("hitstopManager");HitstopManager.prototype.initialize=function(){var hitStop=function(){var a={value:0};t.tween(a).to({value:1},.1,pc.Linear).onUpdate((function(){t.timeScale=a.value})).start()},t=this.app;this.app.on("enemyLoader:hit",(function(){hitStop()})),this.app.on("playerLoader:Riposte-end",(function(){hitStop()}))};var ResultPopup=pc.createScript("resultPopup");ResultPopup.prototype.initialize=function(){const{app:e,entity:t}=this;e.on("playerLoader:lateParry",(function(){t.element.text="LATE";var e={value:1};this.tween(e).to({value:0},1,pc.CubicIn).onUpdate((function(){t.element.opacity=e.value})).start()})),e.on("playerLoader:earlyParry",(function(){t.element.text="EARLY";var e={value:1};this.tween(e).to({value:0},1,pc.CubicIn).onUpdate((function(){t.element.opacity=e.value})).start()}))};var TestParticle=pc.createScript("testParticle");TestParticle.prototype.initialize=function(){const t=this,{app:e,entity:i}=t;e.on("playerLoader:Riposte-end",(()=>{t.mainVfx=i.particlesystem,t.mainVfx.reset(),t.mainVfx.play()}),this)};var HideOnloading=pc.createScript("hideOnloading");const hideElement=function(){this.entity.element.enabled=!1};HideOnloading.prototype.initialize=function(){this.app.on("gameStateManager:loaded",hideElement,this)};var ShowOnloading=pc.createScript("showOnloading");const showElement=function(){const{entity:t}=this;t.element.opacity=1};ShowOnloading.prototype.initialize=function(){const{app:t}=this;t.on("gameStateManager:loaded",showElement,this)};var VolumeBar=pc.createScript("volumeBar");VolumeBar.prototype.initialize=function(){const{app:e,entity:a}=this,o=localStorage.getItem(LAST_VOLUME_KEY);a.scrollbar.value=o,a.scrollbar.on("set:value",(a=>{e.fire("volumeBar:onChange",a)}))};function debounce(t,e=100,o={}){if("function"!=typeof t)throw new TypeError(`Expected the first parameter to be a function, got \`${typeof t}\`.`);if(e<0)throw new RangeError("`wait` must not be negative.");const{immediate:i}="boolean"==typeof o?{immediate:o}:o;let n,r,a,c,f;function later(){const o=Date.now()-c;if(o<e&&o>=0)a=setTimeout(later,e-o);else if(a=void 0,!i){const e=n,o=r;n=void 0,r=void 0,f=t.apply(e,o)}}const debounced=function(...o){if(n&&this!==n)throw new Error("Debounced method called with different contexts.");n=this,r=o,c=Date.now();const d=i&&!a;if(a||(a=setTimeout(later,e)),d){const e=n,o=r;n=void 0,r=void 0,f=t.apply(e,o)}return f};return debounced.clear=()=>{a&&(clearTimeout(a),a=void 0)},debounced.flush=()=>{if(!a)return;const e=n,o=r;n=void 0,r=void 0,f=t.apply(e,o),clearTimeout(a),a=void 0},debounced}(()=>{var i={getFileName:i=>i.substring(i.lastIndexOf("/")+1)};window.utils=window.utils?{...window.utils,...i}:i})();var GameInitializer=pc.createScript("gameInitializer");GameInitializer.attributes.add("cdnUrl",{type:"string"}),GameInitializer.prototype.initialize=async function(){window.globalCdnUrl=this.cdnUrl;const{app:e,cdnUrl:i}=this,t=await fetch(`${i}/dayId`,{cache:"no-cache"}),a=await t.text();e.fire("gameInitializer:retrievedDayId",a);const r=await fetch(`${i}/nextTriggerDate`,{cache:"no-cache"}),n=await r.text();e.fire("gameInitializer:retrieveNextTriggerDate",n),utils.loadGlbContainerFromUrl(`${i}/Platform.glb`,{},"Enemy.glb",(function(i,t){if(i)console.error(i);else{var a=new pc.Entity;a.addChild(t.resource.instantiateRenderEntity()),a.setLocalPosition(0,-.1,0),e.root.addChild(a)}}))};var ReceiveMessage=pc.createScript("receiveMessage");ReceiveMessage.prototype.initialize=function(){const{app:e,entity:t}=this;e.on("gameInitializer:onMessageReceived",(function(e){t.element.text=e;var i={value:1};this.tween(i).to({value:0},3,pc.CubicIn).onUpdate((function(){t.element.opacity=i.value})).start()}))};var FixedTimestep=pc.createScript("fixedTimestep");const targetDelta=1/60;FixedTimestep.prototype.initialize=function(){this.timeSinceLastUpdate=0},FixedTimestep.prototype.update=function(e){const t=this,{app:i}=t;t.timeSinceLastUpdate+=e,t.timeSinceLastUpdate>=targetDelta&&(i.fire("fixedTimestep:update"),t.timeSinceLastUpdate=0)};var LimitFps=pc.createScript("limitFps");LimitFps.attributes.add("targetFps",{type:"number",default:30}),LimitFps.prototype.initialize=function(){this.app;this.limit(this.targetFps),this.on("attr:targetFps",(function(t,i){this.limit(t)}))},LimitFps.prototype.limit=function(t){var i=this.app;this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),t>=60?i.autoRender=!0:(i.autoRender=!1,this.intervalId=setInterval((function(){i.renderNextFrame=!0}),1e3/t))};var FrameCounter=pc.createScript("frameCounter");FrameCounter.prototype.initialize=function(){const e=this,{app:r}=e;e.currentFrame=0,e.framesSinceBeginning=0,r.on("fixedTimestep:update",(()=>{e.currentFrame++,r.fire("frameCounter:advanceFrame"),e.currentFrame>e.framesSinceBeginning&&(e.framesSinceBeginning=e.currentFrame)}))};var ColorSquaresUi=pc.createScript("colorSquaresUi");ColorSquaresUi.prototype.initialize=function(){this.app.on("gameStateManager:resultsUpdated",(function(t){var i=this.colors[t],s=new pc.Entity;s.addComponent("element",{type:"image",color:i,width:e,height:e}),s.setLocalPosition(this.results.length*(e+o)+e/2,0,0),this.entity.addChild(s),this.results.push({type:t})}),this),this.results=[];var t=localStorage.getItem(DailyResultKey);if(t)try{this.results=JSON.parse(t)}catch{}this.colors={success:new pc.Color(0,1,0),warning:new pc.Color(1,1,0),failure:new pc.Color(1,0,0),late:new pc.Color(1,.647,0),early:new pc.Color(1,.647,0)};for(var e=50,o=10,i=0;i<this.results.length;i++){var s=this.results[i],r=this.colors[s.type],l=new pc.Entity;l.addComponent("element",{type:"image",color:r,width:e,height:e}),l.setLocalPosition(i*(e+o)+e/2,0,0),this.entity.addChild(l)}};var LoadVictoryMessage=pc.createScript("loadVictoryMessage");LoadVictoryMessage.prototype.initialize=function(){const{app:t,entity:e}=this;t.on("gameInitializer:retrievedDayId",(async function(t){const a=await fetch(`${globalCdnUrl}/${t}/Victory`,{cache:"no-cache"}),i=await a.text();e.element.text=i}))};var SocketConnection=pc.createScript("socketConnection");SocketConnection.prototype.initialize=function(){console.log("Connect to websocket");const e=this,o=new WebSocket("wss://jjb5stw6la.execute-api.us-east-1.amazonaws.com/development/");o.onopen=function(e){console.log(e)},o.onmessage=function(o){const n=JSON.parse(o.data);e.app.fire("gameInitializer:onMessageReceived",n.message)},o.onclose=function(e){e.wasClean&&console.log(e)},o.onerror=function(e){console.error(e)}};var UpdateCountdown=pc.createScript("updateCountdown");UpdateCountdown.prototype.initialize=function(){const e=this;this.app.on("gameInitializer:retrieveNextTriggerDate",(function(t){e.timeDifferenceCalculator.targetDateTime=new Date(t)})),e.timeDifferenceCalculator=window.TimeDifferenceCalculator.create(),e.timeFormatter=window.TimeFormatter.create()},UpdateCountdown.prototype.update=function(){var e=this.timeDifferenceCalculator.calculateDifference(new Date);this.entity.element.text=`Next challenge in ${this.timeFormatter.format(e)}`};(()=>{const e={create:function(e){return{targetDateTime:e,calculateDifference:function(e){return this.targetDateTime-e}}}};window.TimeDifferenceCalculator=e})();(()=>{function padDigits(t){return t.toString().padStart(2,"0")}const t={create:()=>({format:t=>{let r=Math.floor(t/1e3),a=Math.floor(r/60),i=Math.floor(a/60);return r=padDigits(r%60),a=padDigits(a%60),i=padDigits(i),`${i}:${a}:${r}`}})};window.TimeFormatter=t})();var EnvironmentLoader=pc.createScript("environmentLoader");EnvironmentLoader.prototype.initialize=function(){};var OpenTutorialButton=pc.createScript("openTutorialButton");OpenTutorialButton.prototype.initialize=function(){const{app:t,entity:n}=this;n.button.on("click",(function(){window.open("https://youtu.be/n7wGcrYzK1A")})),n.button.on("hoverstart",(function(){n.element.text="Open In Youtube"})),n.button.on("hoverend",(function(){n.element.text="How To Play"}))};